# Fragmetric Telegram Mini App

![Telegram Mini App](./assets/telegram-miniapp-banner.png)

Fragmetricì€ Telegram Mini App í”Œë«í¼ì„ ìœ„í•œ ê²Œì„ ë° ì†Œì…œ ê²½í—˜ì„ ì œê³µí•˜ëŠ” í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. ì‚¬ìš©ìëŠ” í´ë¦¬ì»¤ ê²Œì„ì„ í”Œë ˆì´í•˜ê³ , SOL ê°€ê²© ì˜ˆì¸¡ ë² íŒ…ì— ì°¸ì—¬í•˜ë©°, ë¦¬ë”ë³´ë“œë¥¼ í†µí•´ ì¹œêµ¬ë“¤ê³¼ ê²½ìŸí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

- [ì£¼ìš” ê¸°ëŠ¥](#ì£¼ìš”-ê¸°ëŠ¥)
- [ê°œë°œ ê³¼ì • ë° êµ¬í˜„ ë‚´ìš©](#ê°œë°œ-ê³¼ì •-ë°-êµ¬í˜„-ë‚´ìš©)
- [ê¸°ìˆ  ìŠ¤íƒ](#ê¸°ìˆ -ìŠ¤íƒ)
- [í”„ë¡œì íŠ¸ êµ¬ì¡°](#í”„ë¡œì íŠ¸-êµ¬ì¡°)
- [Supabase ì—°ë™ ê°€ì´ë“œ](#supabase-ì—°ë™-ê°€ì´ë“œ)
- [Telegram ë´‡ ë° ë¯¸ë‹ˆì•± ì„¤ì •](#telegram-ë´‡-ë°-ë¯¸ë‹ˆì•±-ì„¤ì •)
- [ê°œë°œ ì‹œì‘í•˜ê¸°](#ê°œë°œ-ì‹œì‘í•˜ê¸°)
- [ë°°í¬ ê°€ì´ë“œ](#ë°°í¬-ê°€ì´ë“œ)
- [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)

## ğŸ® ì£¼ìš” ê¸°ëŠ¥

- **í´ë¦¬ì»¤ ê²Œì„**:

  - ë²„íŠ¼ì„ íƒ­í•˜ì—¬ ì ìˆ˜ íšë“
  - ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ë¡œ íƒ­ ë°©í–¥ì— ë”°ë¼ ë²„íŠ¼ ê¸°ìš¸ì„
  - ë¶€ìŠ¤íŠ¸ ê¸°ëŠ¥ìœ¼ë¡œ ì¼ì • ì‹œê°„ ì ìˆ˜ íšë“ëŸ‰ ì¦ê°€

- **SOL ê°€ê²© ì˜ˆì¸¡ ë² íŒ…**:

  - ì‹¤ì‹œê°„ SOL ê°€ê²© ì°¨íŠ¸ í‘œì‹œ
  - UP/DOWN ë² íŒ… ì‹œìŠ¤í…œ
  - ì¼ì¼ ë² íŒ… ì œí•œ ë° ì ìˆ˜ ë³´ìƒ

- **ë¦¬ë”ë³´ë“œ ì‹œìŠ¤í…œ**:

  - ê¸€ë¡œë²Œ ë° ì¹œêµ¬ ë­í‚¹ ë¹„êµ
  - ë‹¤ì–‘í•œ í•„í„°ë§ ì˜µì…˜ (ì „ì²´, í´ë¦¬ì»¤, ë² íŒ…)
  - ì‚¬ìš©ì ìˆœìœ„ ë° ì ìˆ˜ í‘œì‹œ

- **ê³„ì • ë° íƒœìŠ¤í¬**:

  - ë‹¤ì–‘í•œ íƒœìŠ¤í¬ ì™„ë£Œë¥¼ í†µí•œ ë³´ìƒ íšë“
  - ì¹œêµ¬ ì´ˆëŒ€ ë° ì¶”ì²œ ì‹œìŠ¤í…œ
  - ì‚¬ìš©ì í”„ë¡œí•„ ë° í†µê³„ ê´€ë¦¬

- **Telegram í†µí•©**:

  - ì›í™œí•œ Telegram ì‚¬ìš©ì ì¸ì¦
  - ì„œë²„ ì¸¡ ê²€ì¦ì„ í†µí•œ ë³´ì•ˆ ê°•í™”
  - Telegram WebApp API í™œìš©í•œ UI/UX ìµœì í™”

- **TON ì§€ê°‘ ì—°ê²°**:
  - TON Connectë¥¼ í†µí•œ ì§€ê°‘ ì—°ê²°
  - ë¸”ë¡ì²´ì¸ ê¸°ë°˜ ê¸°ëŠ¥ êµ¬í˜„ ì¤€ë¹„

## ğŸ“ ê°œë°œ ê³¼ì • ë° êµ¬í˜„ ë‚´ìš©

### 1. í”„ë¡œì íŠ¸ ì„¤ê³„ ë° ì•„í‚¤í…ì²˜

**ëª©í‘œ**: í™•ì¥ ê°€ëŠ¥í•˜ê³  ìœ ì§€ë³´ìˆ˜ê°€ ìš©ì´í•œ ë¯¸ë‹ˆì•± êµ¬ì¡° ì„¤ê³„

**êµ¬í˜„ ë‚´ìš©**:

- **ì»´í¬ë„ŒíŠ¸ ê¸°ë°˜ ì„¤ê³„**: ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì»´í¬ë„ŒíŠ¸ë¡œ UI ìš”ì†Œ ë¶„ë¦¬
- **ìƒíƒœ ê´€ë¦¬**: Zustandë¥¼ ì‚¬ìš©í•˜ì—¬ ìƒíƒœ ê´€ë¦¬ ë¡œì§ ëª¨ë“ˆí™”
- **ì •ì  ë‚´ë³´ë‚´ê¸°**: API ë¼ìš°íŠ¸ ì—†ì´ ì •ì  ì‚¬ì´íŠ¸ë¡œ ë°°í¬ ê°€ëŠ¥í•œ êµ¬ì¡° ì„¤ê³„
- **ë‹¤êµ­ì–´ ì§€ì›**: next-intlì„ ì‚¬ìš©í•œ i18n êµ¬í˜„

### 2. ê²Œì„ ë©”ì»¤ë‹ˆì¦˜ êµ¬í˜„

**ëª©í‘œ**: í¥ë¯¸ë¡­ê³  ì‚¬ìš©ì ì°¸ì—¬ë¥¼ ìœ ë„í•˜ëŠ” ê²Œì„ ê²½í—˜ ì œê³µ

**êµ¬í˜„ ë‚´ìš©**:

- **í´ë¦¬ì»¤ ê²Œì„**:

  - Framer Motionì„ í™œìš©í•œ ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜
  - íƒ­ ë°©í–¥ì— ë”°ë¥¸ ë²„íŠ¼ ê¸°ìš¸ì„ íš¨ê³¼ (3D ë³€í™˜)
  - í´ë¦­ ì§€ì ì— ì ìˆ˜ ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ
  - ë¶€ìŠ¤íŠ¸ ì‹œìŠ¤í…œ ë° ì¿¨ë‹¤ìš´ ë©”ì»¤ë‹ˆì¦˜

- **ë² íŒ… ì‹œìŠ¤í…œ**:
  - lightweight-charts ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ì‹¤ì‹œê°„ SOL ê°€ê²© ì°¨íŠ¸ êµ¬í˜„
  - íƒ€ì„í”„ë ˆì„ ì¡°ì ˆ ê¸°ëŠ¥ (1m, 5m, 15m, 1h, 4h, 1d)
  - ë² íŒ… ê²°ê³¼ ì²˜ë¦¬ ë° ì ìˆ˜ ê³„ì‚° ë¡œì§
  - ë² íŒ… ì œí•œ ë° ì¿¨ë‹¤ìš´ ë©”ì»¤ë‹ˆì¦˜

### 3. ë°ì´í„° ê´€ë¦¬ ë° ë°±ì—”ë“œ ì—°ë™

**ëª©í‘œ**: í™•ì¥ ê°€ëŠ¥í•˜ê³  ì‹ ë¢°ì„± ìˆëŠ” ë°ì´í„° ì €ì¥ ë° ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬ì¶•

**êµ¬í˜„ ë‚´ìš©**:

- **Supabase í†µí•©**:

  - ì‚¬ìš©ì, ë² íŒ…, íƒœìŠ¤í¬, ë¦¬ë”ë³´ë“œ ë°ì´í„° ê´€ë¦¬
  - Edge Functionsë¥¼ í™œìš©í•œ ì„œë²„ë¦¬ìŠ¤ ë°±ì—”ë“œ êµ¬í˜„
  - RLS(Row Level Security)ë¥¼ í†µí•œ ë°ì´í„° ì ‘ê·¼ ì œì–´

- **ìƒíƒœ ê´€ë¦¬ ìµœì í™”**:
  - Zustand ìŠ¤í† ì–´ ê°„ ì—°ë™ ë° ìµœì í™”
  - ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì§€ì†ì„± êµ¬í˜„
  - ì„œë²„-í´ë¼ì´ì–¸íŠ¸ ë°ì´í„° ë™ê¸°í™”

### 4. Telegram í†µí•© ë° ì‚¬ìš©ì ì¸ì¦

**ëª©í‘œ**: Telegram í”Œë«í¼ê³¼ì˜ ì›í™œí•œ í†µí•© ë° ë³´ì•ˆ ì¸ì¦ êµ¬í˜„

**êµ¬í˜„ ë‚´ìš©**:

- **Telegram WebApp API í™œìš©**:

  - ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤ë¥¼ Telegram í™˜ê²½ì— ìµœì í™”
  - Telegram í…Œë§ˆì— ë§ëŠ” UI ìë™ ì¡°ì •

- **ì‚¬ìš©ì ì¸ì¦ ì‹œìŠ¤í…œ**:
  - HMAC-SHA256 ì„œëª…ì„ í†µí•œ Telegram initData ê²€ì¦
  - Telegram ì‚¬ìš©ì ì •ë³´ ìë™ ë“±ë¡ ë° ê´€ë¦¬
  - ì„œë²„ë¦¬ìŠ¤ í™˜ê²½ì—ì„œ ë³´ì•ˆ ì¸ì¦ êµ¬í˜„

### 5. UI/UX ë””ìì¸ ë° ìµœì í™”

**ëª©í‘œ**: ì§ê´€ì ì´ê³  ë°˜ì‘ì„± ë†’ì€ ì‚¬ìš©ì ê²½í—˜ ì œê³µ

**êµ¬í˜„ ë‚´ìš©**:

- **ë°˜ì‘í˜• ë””ìì¸**:

  - ë‹¤ì–‘í•œ í™”ë©´ í¬ê¸°ì— ìµœì í™”ëœ ë ˆì´ì•„ì›ƒ
  - Tailwind CSSë¥¼ í™œìš©í•œ ì¼ê´€ëœ ë””ìì¸ ì‹œìŠ¤í…œ

- **ìƒíƒœ í”¼ë“œë°±**:

  - ë¡œë”© ìƒíƒœ, ì—ëŸ¬ ì²˜ë¦¬, ì„±ê³µ ì•Œë¦¼ êµ¬í˜„
  - ì• ë‹ˆë©”ì´ì…˜ì„ í†µí•œ ìì—°ìŠ¤ëŸ¬ìš´ ìƒíƒœ ì „í™˜

- **ì„±ëŠ¥ ìµœì í™”**:
  - ì½”ë“œ ìŠ¤í”Œë¦¬íŒ… ë° ì§€ì—° ë¡œë”©
  - ì´ë¯¸ì§€ ìµœì í™” ë° ìºì‹± ì „ëµ

## ğŸ› ï¸ ê¸°ìˆ  ìŠ¤íƒ

### í”„ë¡ íŠ¸ì—”ë“œ

- **Next.js 14**: íŒŒì¼ ê¸°ë°˜ ë¼ìš°íŒ…, ì •ì  ìƒì„±, ì„œë²„ ì»´í¬ë„ŒíŠ¸ ì§€ì›
- **TypeScript**: íƒ€ì… ì•ˆì •ì„± ë° ê°œë°œ ê²½í—˜ í–¥ìƒ
- **Tailwind CSS**: ìœ í‹¸ë¦¬í‹° ìš°ì„  CSS í”„ë ˆì„ì›Œí¬ë¡œ ë¹ ë¥¸ UI ê°œë°œ
- **Framer Motion**: ê³ ì„±ëŠ¥ ì• ë‹ˆë©”ì´ì…˜ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **Telegram WebApp API**: Telegram ë¯¸ë‹ˆì•± í™˜ê²½ê³¼ì˜ í†µí•©

### ìƒíƒœ ê´€ë¦¬

- **Zustand**: ê²½ëŸ‰í™”ëœ ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬
- **next-intl**: êµ­ì œí™” ë° ë‹¤êµ­ì–´ ì§€ì›

### ë°±ì—”ë“œ ë° ë°ì´í„°

- **Supabase**: ë°±ì—”ë“œ ì„œë¹„ìŠ¤ (ë°ì´í„°ë² ì´ìŠ¤, ì¸ì¦, ìŠ¤í† ë¦¬ì§€)
- **Edge Functions**: ì„œë²„ë¦¬ìŠ¤ í•¨ìˆ˜ ì‹¤í–‰ í™˜ê²½
- **PostgreSQL**: ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤

### ì™¸ë¶€ í†µí•©

- **TON Connect**: TON ë¸”ë¡ì²´ì¸ ì§€ê°‘ ì—°ê²°
- **Telegram Mini Apps SDK**: Telegram í”Œë«í¼ í†µí•©
- **Telegram UI**: ë¯¸ë‹ˆì•± ì „ìš© UI ì»´í¬ë„ŒíŠ¸

### ê°œë°œ ë„êµ¬

- **ESLint**: ì½”ë“œ í’ˆì§ˆ ë° ì¼ê´€ì„± ìœ ì§€
- **pnpm**: íš¨ìœ¨ì ì¸ íŒ¨í‚¤ì§€ ê´€ë¦¬
- **Docker**: ê°œë°œ í™˜ê²½ ì¼ê´€ì„± ë° Edge Functions ê°œë°œ

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
fragmetric-tg-miniapp/
â”œâ”€â”€ public/                   # ì •ì  íŒŒì¼ ë””ë ‰í† ë¦¬
â”‚   â””â”€â”€ telegram-web-app.html # Telegram ë¯¸ë‹ˆì•± ì§„ì…ì 
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                  # Next.js ì•± ë¼ìš°í„°
â”‚   â”œâ”€â”€ components/           # ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ Account/          # ê³„ì • ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ Betting/          # ë² íŒ… ê´€ë ¨ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ Clicker/          # í´ë¦¬ì»¤ ê²Œì„ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â”œâ”€â”€ Leaderboard/      # ë¦¬ë”ë³´ë“œ ì»´í¬ë„ŒíŠ¸
â”‚   â”‚   â””â”€â”€ TabBar/           # íƒ­ ë„¤ë¹„ê²Œì´ì…˜ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ core/                 # í•µì‹¬ ê¸°ëŠ¥ ëª¨ë“ˆ
â”‚   â”‚   â””â”€â”€ i18n/             # êµ­ì œí™” ê´€ë ¨ ì„¤ì •
â”‚   â”œâ”€â”€ hooks/                # ì»¤ìŠ¤í…€ React í›…
â”‚   â”œâ”€â”€ lib/                  # ìœ í‹¸ë¦¬í‹° ë° ì„¤ì •
â”‚   â”œâ”€â”€ store/                # Zustand ìŠ¤í† ì–´
â”‚   â””â”€â”€ types/                # TypeScript íƒ€ì… ì •ì˜
â”œâ”€â”€ supabase/
â”‚   â””â”€â”€ functions/            # Supabase Edge Functions
â”‚       â””â”€â”€ verify-telegram/  # Telegram ì¸ì¦ ê²€ì¦ í•¨ìˆ˜
â”œâ”€â”€ .env.example              # í™˜ê²½ ë³€ìˆ˜ ì˜ˆì œ íŒŒì¼
â”œâ”€â”€ .env.local.example        # ë¡œì»¬ í™˜ê²½ ë³€ìˆ˜ ì˜ˆì œ íŒŒì¼
â”œâ”€â”€ next.config.mjs           # Next.js ì„¤ì •
â””â”€â”€ tsconfig.json             # TypeScript ì„¤ì •
```

## â˜ï¸ Supabase ì—°ë™ ê°€ì´ë“œ

### ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸” êµ¬ì¡°

#### `users` í…Œì´ë¸”

```sql
CREATE TABLE users (
  id TEXT PRIMARY KEY,
  username TEXT,
  first_name TEXT,
  last_name TEXT,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  clicker_score INTEGER DEFAULT 0,
  betting_score INTEGER DEFAULT 0,
  total_score INTEGER DEFAULT 0,
  daily_bets INTEGER DEFAULT 0,
  last_bet_reset TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  last_click_time TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  referral_code TEXT UNIQUE,
  referrer_id TEXT REFERENCES users(id),
  is_telegram_user BOOLEAN DEFAULT FALSE
);
```

#### `bets` í…Œì´ë¸”

```sql
CREATE TABLE bets (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id TEXT REFERENCES users(id),
  amount INTEGER DEFAULT 10,
  type TEXT CHECK (type IN ('UP', 'DOWN')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  result TEXT CHECK (result IN ('WIN', 'LOSE', 'PENDING')) DEFAULT 'PENDING',
  score_earned INTEGER DEFAULT 0,
  sol_price_start NUMERIC NOT NULL,
  sol_price_end NUMERIC
);
```

#### `tasks` í…Œì´ë¸”

```sql
CREATE TABLE tasks (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  title TEXT NOT NULL,
  description TEXT NOT NULL,
  reward INTEGER DEFAULT 10,
  task_type TEXT CHECK (task_type IN ('DAILY', 'SOCIAL', 'ONE_TIME'))
);
```

#### `user_tasks` í…Œì´ë¸”

```sql
CREATE TABLE user_tasks (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id TEXT REFERENCES users(id),
  task_id UUID REFERENCES tasks(id),
  completed BOOLEAN DEFAULT FALSE,
  completed_at TIMESTAMP WITH TIME ZONE,
  UNIQUE(user_id, task_id)
);
```

### Edge Function ì„¤ì •

1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •:

```bash
# Telegram Bot Token
supabase secrets set TELEGRAM_BOT_TOKEN=your_telegram_bot_token

# Supabase ì„œë¹„ìŠ¤ í‚¤ (ì£¼ì˜: SUPABASE_ ì ‘ë‘ì‚¬ëŠ” ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”)
supabase secrets set SERVICE_ROLE_KEY=your_service_role_key

# Supabase URL
supabase secrets set PROJECT_URL=your_project_url
```

2. Edge Function ë°°í¬:

```bash
supabase functions deploy verify-telegram
```

### ë³´ì•ˆ ì„¤ì •

1. Row Level Security (RLS) ì •ì±…:

```sql
-- ì‚¬ìš©ì í…Œì´ë¸” ë³´ì•ˆ ì •ì±…
ALTER TABLE users ENABLE ROW LEVEL SECURITY;
CREATE POLICY "ì‚¬ìš©ìëŠ” ìì‹ ì˜ ë°ì´í„°ë§Œ ì½ê³  ìˆ˜ì • ê°€ëŠ¥" ON users
  USING (id = auth.uid())
  WITH CHECK (id = auth.uid());

-- ëª¨ë“  ì‚¬ìš©ìê°€ ì½ê¸° ê°€ëŠ¥í•œ ì •ì±…
CREATE POLICY "ëª¨ë“  ì‚¬ìš©ìê°€ ì½ê¸° ê°€ëŠ¥" ON users
  FOR SELECT USING (true);
```

2. API ê¶Œí•œ ì œí•œ:

```sql
-- ìµëª… ì‚¬ìš©ìì˜ ì§ì ‘ ìˆ˜ì • ë°©ì§€
REVOKE UPDATE, DELETE ON users FROM anon;
```

## ğŸ“± Telegram ë´‡ ë° ë¯¸ë‹ˆì•± ì„¤ì •

### 1. Telegram ë´‡ ìƒì„±

1. [@BotFather](https://t.me/botfather)ì—ì„œ `/newbot` ëª…ë ¹ ì‹¤í–‰
2. ë´‡ ì´ë¦„ ë° ì‚¬ìš©ìëª… ì„¤ì •
3. ë´‡ API í† í° ì €ì¥ (`TELEGRAM_BOT_TOKEN`)

### 2. ë¯¸ë‹ˆì•± ìƒì„± ë° ì„¤ì •

1. `/newapp` ëª…ë ¹ìœ¼ë¡œ ë¯¸ë‹ˆì•± ìƒì„±
2. ì•± ì´ë¦„, ì„¤ëª…, ì•„ì´ì½˜ ì„¤ì •
3. ì›¹ ì•± URL ì„¤ì • (ë°°í¬ëœ ë„ë©”ì¸ + `/telegram-web-app.html`)

### 3. ë¯¸ë‹ˆì•± ì¸ì¦ íë¦„

**ì‘ë™ ë°©ì‹**:

1. ì‚¬ìš©ìê°€ Telegramì—ì„œ ë¯¸ë‹ˆì•± ì‹¤í–‰
2. Telegramì´ `initData` ì œê³µ (ì‚¬ìš©ì ì •ë³´, ì¸ì¦ í•´ì‹œ í¬í•¨)
3. ë¯¸ë‹ˆì•±ì´ Edge Functionìœ¼ë¡œ `initData` ì „ì†¡
4. Edge Functionì´ HMAC-SHA256 ì„œëª…ìœ¼ë¡œ ë°ì´í„° ê²€ì¦
5. ê²€ì¦ ì„±ê³µ ì‹œ ì‚¬ìš©ì ë“±ë¡/ë¡œê·¸ì¸ ì²˜ë¦¬

```mermaid
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant TG as Telegram
    participant App as ë¯¸ë‹ˆì•±
    participant Edge as Edge Function
    participant DB as Supabase DB

    User->>TG: ë´‡ ë¯¸ë‹ˆì•± ì—´ê¸°
    TG->>App: initData ì œê³µ
    App->>Edge: initData ì „ì†¡
    Edge->>Edge: HMAC ê²€ì¦
    Edge->>DB: ì‚¬ìš©ì ì¡°íšŒ/ìƒì„±
    DB->>Edge: ì‚¬ìš©ì ì •ë³´
    Edge->>App: ì¸ì¦ ê²°ê³¼
    App->>User: ì•± UI í‘œì‹œ
```

## ğŸ’» ê°œë°œ ì‹œì‘í•˜ê¸°

### í™˜ê²½ ì„¤ì •

1. ì €ì¥ì†Œ í´ë¡ :

```bash
git clone https://github.com/yourusername/fragmetric-tg-miniapp.git
cd fragmetric-tg-miniapp
```

2. ì˜ì¡´ì„± ì„¤ì¹˜:

```bash
pnpm install
```

3. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •:

```bash
cp .env.local.example .env.local
# .env.local íŒŒì¼ í¸ì§‘í•˜ì—¬ ì‹¤ì œ ê°’ ì„¤ì •
```

### ê°œë°œ ì„œë²„ ì‹¤í–‰

1. ì¼ë°˜ ê°œë°œ ì„œë²„:

```bash
pnpm dev
```

2. HTTPS ê°œë°œ ì„œë²„ (Telegram í…ŒìŠ¤íŠ¸ìš©):

```bash
pnpm dev:https
```

### ì½”ë“œ ê·œì¹™ ê²€ì‚¬

```bash
pnpm lint
```

### ë¹Œë“œ ë° ë°°í¬

1. í”„ë¡œë•ì…˜ ë¹Œë“œ:

```bash
pnpm build
```

2. ë¡œì»¬ì—ì„œ í”„ë¡œë•ì…˜ ë¹Œë“œ í…ŒìŠ¤íŠ¸:

```bash
pnpm start
```

## ğŸš€ ë°°í¬ ê°€ì´ë“œ

### ì •ì  ì‚¬ì´íŠ¸ ë°°í¬ (ê¶Œì¥)

ì´ í”„ë¡œì íŠ¸ëŠ” ì •ì  ì‚¬ì´íŠ¸ë¡œ ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `next.config.mjs` íŒŒì¼ì— ë‹¤ìŒ ì„¤ì •ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

```javascript
const nextConfig = {
  output: 'export',
  images: {
    unoptimized: true
  }
}
```

#### Vercel ë°°í¬

```bash
pnpm dlx vercel deploy --prod
```

#### Netlify ë°°í¬

```bash
pnpm dlx netlify deploy --prod
```

### Supabase Edge Functions ë°°í¬

```bash
# í•„ìˆ˜: Supabase CLI ì„¤ì¹˜
npm install -g supabase

# ë¡œê·¸ì¸ ë° í”„ë¡œì íŠ¸ ì—°ê²°
supabase login
supabase link --project-ref your_project_id

# Edge Functions ë°°í¬
supabase functions deploy verify-telegram
```

### Telegram ë¯¸ë‹ˆì•± URL ë“±ë¡

ë°°í¬ í›„, BotFatherì—ì„œ `/mybots` â†’ ë´‡ ì„ íƒ â†’ Bot Settings â†’ Menu Button â†’ Web App URL ì„¤ì •

URL í˜•ì‹: `https://your-domain.com/telegram-web-app.html`

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### 1. ë¹Œë“œ ì˜¤ë¥˜ í•´ê²°

#### Server Actions ê´€ë ¨ ì˜¤ë¥˜

ì˜¤ë¥˜ ë©”ì‹œì§€: `Server Actions are not supported with static export.`

í•´ê²°ì±…:

```javascript
// 'use server' ì§€ì‹œë¬¸ì„ 'use client'ë¡œ ë³€ê²½
// ì„œë²„ ì•¡ì…˜ ëŒ€ì‹  í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì½”ë“œ ì‚¬ìš©
```

#### Supabase Edge Functions ê´€ë ¨ ì˜¤ë¥˜

ì˜¤ë¥˜ ë©”ì‹œì§€: `Cannot find module 'https://deno.land/...'`

í•´ê²°ì±…:

```javascript
// next.config.mjs íŒŒì¼ì—ì„œ Edge Functions ë””ë ‰í† ë¦¬ ì œì™¸
webpack: (config) => {
  config.module.rules.push({
    test: /supabase\/functions\/.*\.ts$/,
    loader: 'ignore-loader',
  });
  return config;
},
```

### 2. Telegram ì¸ì¦ ë¬¸ì œ

#### initData ê²€ì¦ ì˜¤ë¥˜

ì˜¤ë¥˜ ë©”ì‹œì§€: `Invalid Telegram data`

í•´ê²°ì±…:

- BOT_TOKEN ê°’ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
- ì„œëª… ìƒì„± ì•Œê³ ë¦¬ì¦˜ ê²€í†  (ë°ì´í„° ì •ë ¬, í•´ì‹œ ìƒì„± ë°©ì‹)
- Edge Function ë¡œê·¸ í™•ì¸

#### í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ë¬¸ì œ

ì˜¤ë¥˜ ë©”ì‹œì§€: `Missing Supabase configuration`

í•´ê²°ì±…:

- Supabase Edge Function í™˜ê²½ ë³€ìˆ˜ í™•ì¸:
  ```bash
  supabase secrets list
  ```
- Supabase ì˜ˆì•½ì–´ ì ‘ë‘ì‚¬(`SUPABASE_`) ì‚¬ìš© í”¼í•˜ê¸°

### 3. ê¸°íƒ€ ì¼ë°˜ì ì¸ ë¬¸ì œ

#### ê°œë°œ ì„œë²„ì—ì„œ Telegram WebApp ë¯¸ì‘ë™

í•´ê²°ì±…:

- HTTPS ê°œë°œ ì„œë²„ ì‚¬ìš©: `pnpm dev:https`
- Telegram WebApp API ëª¨ì˜ êµ¬í˜„ ì‚¬ìš© (ê°œë°œ ëª¨ë“œì—ì„œë§Œ)

#### ì„±ëŠ¥ ìµœì í™”

- ì´ë¯¸ì§€ ìµœì í™” ë° ì§€ì—° ë¡œë”© í™œì„±í™”
- ì½”ë“œ ìŠ¤í”Œë¦¬íŒ… êµ¬í˜„
- API ìš”ì²­ ìºì‹± ë° ì¬ì‹œë„ ë¡œì§ ì¶”ê°€

## í”„ë¡œì íŠ¸ ê°œë°œ ê³¼ì • (ê°œë°œ ë¡œê·¸)

### 1. Telegram ë¯¸ë‹ˆì•± í”„ë¡œì íŠ¸ ì´ˆê¸° ì„¤ì •

**ëª©í‘œ**: í…”ë ˆê·¸ë¨ ë¯¸ë‹ˆì•± í”Œë«í¼ì—ì„œ ì‘ë™í•˜ëŠ” Next.js ê¸°ë°˜ ì•± êµ¬ì¶•

**êµ¬í˜„ ê³¼ì •**:

- Next.js 14ì™€ TypeScript ê¸°ë°˜ í”„ë¡œì íŠ¸ ì´ˆê¸°í™”
- Telegram WebApp API ë° TON Connect ì˜ì¡´ì„± ì¶”ê°€
- íŒŒì¼ ê¸°ë°˜ ë¼ìš°íŒ… êµ¬ì¡° ì„¤ì •
- Root ì»´í¬ë„ŒíŠ¸ë¥¼ í†µí•œ TonConnectUIProvider í†µí•©

**ê¸°ìˆ ì  ê³¼ì œ**:

- `TonConnectProvider` ì„¤ì • ì˜¤ë¥˜ í•´ê²°ì„ ìœ„í•œ Root ì»´í¬ë„ŒíŠ¸ êµ¬ì¡°í™”
- TON ì§€ê°‘ ì—°ê²° ê³¼ì •ì—ì„œ App Manifest ì˜¤ë¥˜ ë””ë²„ê¹…
- `tonconnect-manifest.json`ì˜ URL ì„¤ì • ì¡°ì •

### 2. ì •ì  ì‚¬ì´íŠ¸ë¡œ ë°°í¬ ì¤€ë¹„

**ëª©í‘œ**: API ë¼ìš°íŠ¸ ì—†ì´ ì •ì  ë°°í¬ ê°€ëŠ¥í•œ êµ¬ì¡°ë¡œ ë³€í™˜

**êµ¬í˜„ ê³¼ì •**:

- `next.config.mjs` ìˆ˜ì •í•˜ì—¬ `output: 'export'` ì„¤ì • ì¶”ê°€
- API ë¼ìš°íŠ¸(`/api/*`)ë¥¼ ì •ì  í˜¸í™˜ ì½”ë“œë¡œ ëŒ€ì²´:
  - `src/app/api/betting/route.ts`
  - `src/app/api/user/route.ts`
  - `src/app/api/task/route.ts`
  - `src/app/api/leaderboard/route.ts`
  - `src/app/api/sol-price/route.ts`
- ì •ì  ë°°í¬ì—ì„œ Server Actions ì‚¬ìš© ì¤‘ë‹¨:
  - `src/core/i18n/locale.ts` íŒŒì¼ì—ì„œ `"use server";` â†’ `"use client";`ë¡œ ë³€ê²½
  - ì¿ í‚¤ ì¡°ì‘ ë¡œì§ì„ í´ë¼ì´ì–¸íŠ¸ ì¸¡ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
  - `LocaleSwitcher` ì»´í¬ë„ŒíŠ¸ ìˆ˜ì •í•˜ì—¬ ìƒˆë¡œìš´ locale ì„¤ì • í›„ í˜ì´ì§€ ë¦¬ë¡œë“œ êµ¬í˜„

**ê¸°ìˆ ì  ê³¼ì œ**:

- ë¹Œë“œ ê³¼ì •ì—ì„œ ë°œìƒí•œ "Server Actions are not supported with static export" ì˜¤ë¥˜ í•´ê²°
- ESLint ê²½ê³  ë° ì˜¤ë¥˜ ìˆ˜ì • (React Hooks ì˜ì¡´ì„±, ì´ìŠ¤ì¼€ì´í”„ ë¬¸ì, ìº¡ìŠí™” ë“±)

### 3. Telegram Bot ë° ì›¹í›… ì„¤ì •

**ëª©í‘œ**: í…”ë ˆê·¸ë¨ ë´‡ê³¼ ë¯¸ë‹ˆì•± ì—°ë™ì„ ìœ„í•œ ì„œë²„ë¦¬ìŠ¤ ë°±ì—”ë“œ êµ¬ì¶•

**êµ¬í˜„ ê³¼ì •**:

1. **ë´‡ ê¸°ë³¸ ì„¤ì •**:

   - BotFatherë¥¼ í†µí•œ `@fragtopu_bot` ìƒì„±
   - ë´‡ ì •ë³´(ì´ë¦„, ì„¤ëª…, ëª…ë ¹ì–´ ë“±) ì„¤ì •

2. **Edge Function êµ¬í˜„**:

   - Supabase Edge Functionsë¥¼ í™œìš©í•œ `telegram-bot` í•¨ìˆ˜ ê°œë°œ
   - Telegram APIì™€ í†µì‹ í•˜ê¸° ìœ„í•œ ë©”ì‹œì§€ ì²˜ë¦¬ ë¡œì§ êµ¬í˜„
   - `/start` ëª…ë ¹ì–´ ì²˜ë¦¬ ë° ë¯¸ë‹ˆì•± ì‹¤í–‰ ë²„íŠ¼ ì œê³µ

3. **ì¸ì¦ ë° ë³´ì•ˆ**:
   - Edge Functionì— `TELEGRAM_BOT_TOKEN` í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
   - JWT ì¸ì¦ ë¹„í™œì„±í™” ì„¤ì • (`supabase/config.toml` ìˆ˜ì •)
   - ì›¹í›… ì„¤ì • ë° ì˜¤ë¥˜ ì²˜ë¦¬

**ê¸°ìˆ ì  ê³¼ì œ**:

- ì›¹í›… ì„¤ì • ì‹œ 401 Unauthorized ì˜¤ë¥˜ í•´ê²°
- Edge Function ë¡œê·¸ë¥¼ í†µí•œ ìš”ì²­/ì‘ë‹µ ë””ë²„ê¹…
- í…”ë ˆê·¸ë¨ ë©”ì‹œì§€ì™€ ë¯¸ë‹ˆì•± URL ê²½ë¡œ ë¬¸ì œ í•´ê²°

### 4. ë¯¸ë‹ˆì•± URL ë° ë°°í¬ ìµœì í™”

**ëª©í‘œ**: ë¯¸ë‹ˆì•± ì§„ì…ì  ë° ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

**êµ¬í˜„ ê³¼ì •**:

1. **ì§„ì…ì  ì„¤ì •**:

   - `public/telegram-web-app.html` íŒŒì¼ êµ¬í˜„
   - Telegram WebApp API ì´ˆê¸°í™” ë° ë©”ì¸ ì•±ìœ¼ë¡œ ë¼ìš°íŒ…

2. **URL ê²½ë¡œ ìµœì í™”**:

   - ë£¨íŠ¸ URLì„ ë¯¸ë‹ˆì•± ì§„ì…ì ìœ¼ë¡œ ì„¤ì •
   - 404 ì˜¤ë¥˜ í•´ê²°ì„ ìœ„í•œ ê²½ë¡œ ìµœì í™”

3. **ë°°í¬ íŒŒì´í”„ë¼ì¸**:
   - Vercelì„ í†µí•œ ì •ì  ì‚¬ì´íŠ¸ ë°°í¬
   - Edge Functionì˜ ì§€ì†ì  ë°°í¬

**ê¸°ìˆ ì  ê³¼ì œ**:

- í…”ë ˆê·¸ë¨ ë²„íŠ¼ì—ì„œ ë¯¸ë‹ˆì•± URL ì ‘ê·¼ ì‹œ 404 ì˜¤ë¥˜ í•´ê²°
- ì •ì  ì‚¬ì´íŠ¸ ë°°í¬ì˜ ê²½ë¡œ ì²˜ë¦¬ ì´í•´ ë° ìµœì í™”

## Telegram Bot í†µí•© ê°€ì´ë“œ

### ë´‡ ì„¤ì • ë°©ë²•

1. **ë´‡ ìƒì„±**:

   ```
   @BotFatherì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ ì‹¤í–‰:
   /newbot
   <ë´‡ ì´ë¦„ ì…ë ¥: FragTopu>
   <ë´‡ ì‚¬ìš©ìëª… ì…ë ¥: fragtopu_bot>
   ```

2. **ë¯¸ë‹ˆì•± ìƒì„±**:

   ```
   /newapp
   <ë´‡ ì„ íƒ: @fragtopu_bot>
   <ì•± ì œëª© ì…ë ¥: FragTopu>
   <ì•± ì„¤ëª… ì…ë ¥>
   <ì•± ì•„ì´ì½˜ ì—…ë¡œë“œ>
   ```

3. **ëª…ë ¹ì–´ ì„¤ì •**:
   ```
   /mybots
   <ë´‡ ì„ íƒ: @fragtopu_bot>
   Edit Bot > Edit Commands
   start - Start the bot and launch FragTopu mini app
   help - Display help and usage guide
   rank - Check your current ranking
   invite - Generate a friend invitation link
   ```

### Edge Function êµ¬í˜„ ìƒì„¸

**telegram-bot Edge Functionì˜ ì£¼ìš” ê¸°ëŠ¥**:

1. **Telegram API í†µì‹ **:

   ```typescript
   async function sendTelegramMessage(chatId: number, text: string, replyMarkup?: any): Promise<any> {
     const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`

     const params = {
       chat_id: chatId,
       text: text,
       parse_mode: 'Markdown',
       reply_markup: replyMarkup
     }

     const response = await fetch(url, {
       /* ... */
     })
     return await response.json()
   }
   ```

2. **ëª…ë ¹ì–´ ì²˜ë¦¬**:

   ```typescript
   if (text.includes('/start')) {
     // í™˜ì˜ ë©”ì‹œì§€ ë° ë²„íŠ¼ ì„¤ì •
     const welcomeMessage = `ğŸ® Welcome to FragTopu! ğŸ†...`

     const replyMarkup = {
       inline_keyboard: [
         [{ text: 'Start Playing', web_app: { url: 'https://fragmetric-tg-miniapp.vercel.app' } }],
         [{ text: 'Our Community', url: 'https://t.me/fragmetric_community' }]
       ]
     }

     await sendTelegramMessage(chatId, welcomeMessage, replyMarkup)
   }
   ```

3. **ì›¹í›… ì„¤ì •**:

   ```bash
   curl -X POST "https://api.telegram.org/bot<BOT_TOKEN>/setWebhook" \
        -H "Content-Type: application/json" \
        -d '{"url":"https://yuklvuxnvzgwfoehhvwm.supabase.co/functions/v1/telegram-bot"}'
   ```

4. **ë³´ì•ˆ ì„¤ì •** (`supabase/config.toml`):
   ```toml
   [functions.telegram-bot]
   verify_jwt = false
   ```

### ë¯¸ë‹ˆì•± ì§„ì…ì  êµ¬í˜„

**telegram-web-app.htmlì˜ í•µì‹¬ ê¸°ëŠ¥**:

1. **Telegram WebApp ì´ˆê¸°í™”**:

   ```javascript
   if (window.Telegram && window.Telegram.WebApp) {
     try {
       // Telegram WebApp ì¤€ë¹„
       window.Telegram.WebApp.ready()

       // Viewport í™•ì¥
       window.Telegram.WebApp.expand()

       // ë©”ì¸ ì•±ìœ¼ë¡œ ì´ë™
       window.location.href = '/'
     } catch (error) {
       console.error('Telegram WebApp ì´ˆê¸°í™” ì˜¤ë¥˜:', error)
     }
   }
   ```

2. **ë¹„ Telegram í™˜ê²½ ì²˜ë¦¬**:
   ```javascript
   else {
     // Telegram í™˜ê²½ì´ ì•„ë‹Œ ê²½ìš° ì¼ë°˜ ì›¹ì‚¬ì´íŠ¸ì²˜ëŸ¼ í‘œì‹œ
     document.getElementById('loading').style.display = 'none';
     document.getElementById('app').style.display = 'block';
   }
   ```

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ë° í•™ìŠµ ë‚´ìš©

### 1. Telegram ì›¹í›… ì¸ì¦ ë¬¸ì œ

**ë¬¸ì œ**: Edge Functionì—ì„œ `401 Unauthorized` ì˜¤ë¥˜ ë°œìƒ

**í•´ê²°**:

- `supabase/config.toml`ì—ì„œ JWT ê²€ì¦ ë¹„í™œì„±í™”: `verify_jwt = false`
- Edge Function ë¡œê¹… ë° ë””ë²„ê¹… ê°•í™”
- ì‘ë‹µ í—¤ë”ì— ì ì ˆí•œ CORS ì„¤ì • ì¶”ê°€

### 2. ë¯¸ë‹ˆì•± URL 404 ì˜¤ë¥˜

**ë¬¸ì œ**: í…”ë ˆê·¸ë¨ ë²„íŠ¼ì—ì„œ ë¯¸ë‹ˆì•± URL ì ‘ê·¼ ì‹œ 404 ì˜¤ë¥˜

**í•´ê²°**:

- ìƒëŒ€ ê²½ë¡œ ëŒ€ì‹  ì ˆëŒ€ URL ì‚¬ìš©
- ë³µì¡í•œ ê²½ë¡œ êµ¬ì¡° ëŒ€ì‹  ë£¨íŠ¸ URL(`https://fragmetric-tg-miniapp.vercel.app`) ì‚¬ìš©
- `telegram-web-app.html`ì—ì„œ ì ì ˆí•œ ë¦¬ë””ë ‰ì…˜ ì²˜ë¦¬

### 3. ì •ì  ì‚¬ì´íŠ¸ ë°°í¬ ìµœì í™”

**í•™ìŠµ ë‚´ìš©**:

- Next.js ì •ì  ë‚´ë³´ë‚´ê¸°ì˜ ê²½ë¡œ ì²˜ë¦¬ ì´í•´
- ì„œë²„ë¦¬ìŠ¤ í™˜ê²½ì—ì„œì˜ API ëª¨ë¸ë§
- í…”ë ˆê·¸ë¨ WebApp APIì™€ ì™¸ë¶€ ì›¹ì‚¬ì´íŠ¸ í†µí•© ë°©ë²•

## í–¥í›„ ê°œë°œ ê³„íš

1. **ì‚¬ìš©ì ê²½í—˜ ê°œì„ **:

   - ë¯¸ë‹ˆì•± ë‚´ ë¡œë”© ìƒíƒœ ìµœì í™”
   - ë‹¤êµ­ì–´ ì§€ì› í™•ì¥

2. **ê¸°ëŠ¥ ì¶”ê°€**:

   - ë” ë§ì€ ë¯¸ë‹ˆê²Œì„ í†µí•©
   - ì†Œì…œ ê¸°ëŠ¥ ê°•í™” (ì¹œêµ¬ ì´ˆëŒ€, ê³µìœ  ë“±)
   - í† í° ê¸°ë°˜ ë³´ìƒ ì‹œìŠ¤í…œ

3. **ì„±ëŠ¥ ìµœì í™”**:
   - ì´ë¯¸ì§€ ë° ë¦¬ì†ŒìŠ¤ ìµœì í™”
   - í´ë¼ì´ì–¸íŠ¸ ì¸¡ ìºì‹± ì „ëµ
   - ì˜¤í”„ë¼ì¸ ì§€ì› ê°œì„ 
